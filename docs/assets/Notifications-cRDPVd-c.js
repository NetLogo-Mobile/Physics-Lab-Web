import{b as B,p as P,s as K,_ as L,d as z,e as A,g as W,f as G,h as H,H as q,F as X}from"./index-D6Hz3-vS.js";import{j as M,r as b,o as J,w as Y,c as Z,P as F,K as C,O as y,L as n,M as o,V as tt,J as e,e as V,Q as et,R as r,F as Q,W as it,S as nt}from"./vue-DM6FGnPB.js";import{g as st}from"./getUserCurentAvatarByID-C_abxhlB.js";import{i as at}from"./infiniteScroll-CP5iaxsj.js";import"./domPurify-BPcjySmD.js";const ot={class:"notification_container"},ct=["src"],rt=["innerHTML"],lt={id:"notification_message",class:"notification_message"},dt={id:"notification_icon",class:"notification_icon"},ut=["src"],ft={id:"notification_text",class:"notification_text"},pt=M({__name:"NotificationItem",props:{notification:{}},setup(l){const t=l,d=b("/@base/assets/user/default-avatar.png"),u=async()=>{d.value=t.notification.msg_type===1?"/@base/assets/messages/Message-Unread.png":await st(t.notification.uid)};J(u),Y(()=>t.notification.uid,u);const c=Z(()=>{switch(t.notification.msg_type){case 1:return"/@base/assets/icons/notifications_system.png";case 2:return"/@base/assets/icons/notifications_comments.png";case 3:return"/@base/assets/icons/notifications_followers.png";case 4:return"/@base/assets/icons/notifications_projects.png";case 5:return"/@base/assets/icons/notifications_admin.png";default:return""}});function f(){t.notification.msg_type===2&&window.open("".concat(window.$getPath("/@root"),"/Comments/").concat(t.notification.category,"/").concat(t.notification.tid,"/").concat(t.notification.name),"_self")}return(w,T)=>{const x=F("n-ellipsis");return y(),C("div",ot,[n("div",{class:"img",onClick:T[0]||(T[0]=tt(k=>o(K)(l.notification.uid),["stop"]))},[n("img",{id:"avatar",src:o(B)(d.value)},null,8,ct)]),n("div",{id:"notification",class:"notification",onClick:f},[n("div",{id:"notification_title",class:"notification_title",innerHTML:o(P)(l.notification.msg_title,!0)},null,8,rt),n("div",lt,[n("div",dt,[n("img",{id:"notification_icon",src:o(B)(c.value)},null,8,ut)]),n("div",ft,[e(x,{"expand-trigger":"click","line-clamp":"2",tooltip:!1,innerHTML:o(P)(l.notification.msg,!0)},null,8,["innerHTML"])])])])])}}}),_t=L(pt,[["__scopeId","data-v-5bcc06af"]]),mt=M({__name:"NotificationList",props:{notificationTypeIndexOfUI:{}},setup(l){V(()=>{window.$Logger.logPageView({pageLink:"/Social/Notifications/".concat(x(l.notificationTypeIndexOfUI),"/"),timeStamp:Date.now()})});const{locale:t}=z(),d=b([]),u=b(!1);let c=b(0);const f=b(!1);let w=[{ID:"5c90f172a2409b51dc5cb945",Identifier:"Letter-Test",CategoryID:1,Management:!1,Subject:{Chinese:"一封测试邮件 {Users}",English:"A letter for test {Users}",ChineseTraditional:"一封測試郵件 {Users}",German:"Ein Brief für den Test {Benutzer}",French:"Une lettre pour le test {Utilisateurs}",Japanese:"テスト用の手紙{Users}",Italian:"Una lettera per il test {Utenti}",Polish:null,Spanish:null,Ukrainian:null},Content:{Chinese:"这是一封测试邮件，用于测试所有功能。{Users}",English:"This is a letter for test to test every features. {Users}",ChineseTraditional:"這是一封測試郵件，用於測試所有功能。 {Users}",German:"Dies ist ein Testbrief zum Testen aller Funktionen. {Benutzer}",French:"Ceci est une lettre de test pour tester toutes les fonctionnalités. {Utilisateurs}",Japanese:"これはすべての機能をテストするためのテスト用の手紙です。 {ユーザー}",Italian:"Questa è una lettera per test per testare tutte le funzionalità. {} utenti",Polish:null,Spanish:null,Ukrainian:null},Description:null,Bonuses:{Fragment:1},Action:null,CombineLimit:0,AvailableFrom:15463224e5,AvailableUntil:18934776e5,Push:0}];function T(a){return a===2?3:a===3?2:a}function x(a){return a===3?2:a===2?3:a}function k(a,s){var _,m,i,h,v,I,U;return a.replace(/{Users}/g,s.Users.map((D,$)=>"<user=".concat(D,">").concat(s.UserNames[$],"</user>")).join(" ")).replace(/{Experiment}/g,(_=s.Fields)!=null&&_.Discussion?"<discussion=".concat((m=s.Fields)==null?void 0:m.DiscussionID,">").concat((i=s.Fields)==null?void 0:i.Discussion,"</discussion>"):"<experiment".concat((h=s.Fields)==null?void 0:h.ExperimentID,">").concat((v=s.Fields)==null?void 0:v.Experiment,"</experiment>")).replace(/{\$Content}/g,s.Fields.Content).replace(/{\$TargetName}/g,s.Fields.TargetName||((I=A.getObj("userInfo").value)==null?void 0:I.nickName)).replace(/{\$Until}/g,s.Fields.Unitl).replace(/{\$Editor}/g,s.Fields.Editor).replace(/{\$Gold}/g,(U=s.Numbers)==null?void 0:U.Gold).replace(/undefined/g,"")}const N=async(a=!0)=>{var s;if((s=A.getObj("userInfo").value)!=null&&s.id&&!u.value&&!f.value){u.value=!0;try{const p=await W("/Messages/GetMessages",{CategoryID:x(l.notificationTypeIndexOfUI),Take:20,Skip:c.value,NoTemplates:a});a||(w=p.Data.Templates);const _=p.Data.Messages;_.length===0&&(f.value=!0,G.emit("warning","没有更多了",2));const m=_.map(i=>{var I,U,D,$,E,O,S,j;const h=w.find(R=>R.ID===i.TemplateID),v=["Chinese","English","ChineseTraditional","German","French","Japanese","Italian","Polish","Spanish","Ukrainian"].includes(t.value)?t.value:"Chinese";return{id:i.ID,msg_title:k(h.Subject[v],i),msg:k(h.Content[v],i),msg_type:T(i.CategoryID),category:(I=i.Fields)!=null&&I.User?"User":(U=i.Fields)!=null&&U.Discussion?"Discussion":"Experiment",tid:((D=i.Fields)==null?void 0:D.UserID)||(($=i.Fields)==null?void 0:$.DiscussionID)||((E=i.Fields)==null?void 0:E.ExperimentID)||"",name:((O=i.Fields)==null?void 0:O.Discussion)||((S=i.Fields)==null?void 0:S.Experiment)||((j=i.Fields)==null?void 0:j.User)||"",uid:i.Users[0]}});d.value=[...d.value,...m],u.value=!1,c.value+=20}catch(p){G.emit("error",String(p),5)}}};return N(!1),(a,s)=>{const p=F("n-divider");return y(),et(at,{"has-more":!f.value,"initial-items":d.value,onLoad:N},{default:r(_=>[(y(!0),C(Q,null,it(_.items,m=>(y(),C("div",{key:m.id},[e(_t,{notification:m},null,8,["notification"]),e(p,{style:{margin:"0"}})]))),128))]),_:1},8,["has-more","initial-items"])}}}),g=L(mt,[["__scopeId","data-v-8d7460d5"]]),gt={class:"outer"},ht={class:"item"},vt={class:"item"},It={class:"item"},Ut={class:"item"},bt={class:"item"},yt={class:"item"},Tt=M({__name:"Notifications",setup(l){const{t}=z();return V(H),J(H),(d,u)=>{const c=F("n-tab-pane"),f=F("n-tabs");return y(),C(Q,null,[e(q,null,{default:r(()=>[n("h1",null,nt(o(t)("notifications.title")),1)]),_:1}),n("main",null,[n("div",gt,[e(f,{type:"line",animated:"","justify-content":"space-evenly"},{default:r(()=>[e(c,{name:"全部",tab:o(t)("notifications.all")},{default:r(()=>[n("div",ht,[e(g,{notificationTypeIndexOfUI:0})])]),_:1},8,["tab"]),e(c,{name:"系统消息",tab:o(t)("notifications.system")},{default:r(()=>[n("div",vt,[e(g,{notificationTypeIndexOfUI:1})])]),_:1},8,["tab"]),e(c,{name:"回复和评论",tab:o(t)("notifications.comments")},{default:r(()=>[n("div",It,[e(g,{notificationTypeIndexOfUI:2})])]),_:1},8,["tab"]),e(c,{name:"关注和粉丝",tab:o(t)("notifications.friends")},{default:r(()=>[n("div",Ut,[e(g,{notificationTypeIndexOfUI:3})])]),_:1},8,["tab"]),e(c,{name:"作品",tab:o(t)("notifications.works")},{default:r(()=>[n("div",bt,[e(g,{notificationTypeIndexOfUI:4})])]),_:1},8,["tab"]),e(c,{name:"管理通知",tab:o(t)("notifications.admin")},{default:r(()=>[n("div",yt,[e(g,{notificationTypeIndexOfUI:5})])]),_:1},8,["tab"])]),_:1})])]),e(X)],64)}}}),wt=L(Tt,[["__scopeId","data-v-7c85afc8"]]);export{wt as default};
