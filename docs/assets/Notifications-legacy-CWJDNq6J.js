System.register(["./index-legacy-Jyate2Ug.js","./vue-legacy-BtgHrQi9.js","./getUserCurentAvatarByID-legacy-CEaopGCK.js","./infiniteScroll-legacy-D9EtErDf.js","./domPurify-legacy-Dg5y-r5Q.js"],function(i,t){"use strict";var e,n,a,s,o,l,c,r,d,f,u,p,m,v,g,h,b,x,_,y,I,U,w,T,D,F,C,$,k,j,E;return{setters:[i=>{e=i.b,n=i.p,a=i.s,s=i._,o=i.d,l=i.e,c=i.g,r=i.f,d=i.h,f=i.H,u=i.F},i=>{p=i.j,m=i.r,v=i.o,g=i.w,h=i.c,b=i.P,x=i.K,_=i.O,y=i.L,I=i.M,U=i.V,w=i.J,T=i.e,D=i.Q,F=i.R,C=i.F,$=i.W,k=i.S},i=>{j=i.g},i=>{E=i.i},null],execute:function(){var t=document.createElement("style");t.textContent='.notification_container[data-v-5bcc06af]{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;padding:.5em 0 .5em .5em;display:flex;flex-direction:row;gap:10px;width:90%;box-sizing:border-box;overflow:hidden}#avatar[data-v-5bcc06af]{height:60px;width:60px;border-radius:50%}#avatar[data-v-5bcc06af]:after{content:"";mix-blend-mode:luminosity}#notification[data-v-5bcc06af]{width:100%;display:flex;flex-direction:column;gap:5px}#notification_icon[data-v-5bcc06af]{width:20px;height:20px;top:2px;background-color:transparent;display:flex}#notification_title[data-v-5bcc06af]{font-size:1.1em;margin-right:auto;font-weight:700;white-space:nowrap}#notification_message[data-v-5bcc06af]{width:100%;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;display:flex;flex-direction:row;gap:5px}#notification_text[data-v-5bcc06af]{font-size:.9em;text-align:left;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}#icon[data-v-5bcc06af]{height:16px;width:16px}#notification_container[data-v-5bcc06af]:hover{background-color:#f0f0f0}.text[data-v-8d7460d5]{text-align:center;color:#888}.outer[data-v-7c85afc8]{margin-top:50px}.item[data-v-7c85afc8]{box-sizing:border-box;height:calc(100dvh - 150px)}@media (min-aspect-ratio: 1/1){.item[data-v-7c85afc8]{padding-left:20px}}\n/*$vite$:1*/',document.head.appendChild(t);const O={class:"notification_container"},S=["src"],z=["innerHTML"],L={id:"notification_message",class:"notification_message"},M={id:"notification_icon",class:"notification_icon"},N=["src"],P={id:"notification_text",class:"notification_text"},G=s(p({__name:"NotificationItem",props:{notification:{}},setup(i){const t=i,s=m("/@base/assets/user/default-avatar.png"),o=async()=>{s.value=1===t.notification.msg_type?"/@base/assets/messages/Message-Unread.png":await j(t.notification.uid)};v(o),g(()=>t.notification.uid,o);const l=h(()=>{switch(t.notification.msg_type){case 1:return"/@base/assets/icons/notifications_system.png";case 2:return"/@base/assets/icons/notifications_comments.png";case 3:return"/@base/assets/icons/notifications_followers.png";case 4:return"/@base/assets/icons/notifications_projects.png";case 5:return"/@base/assets/icons/notifications_admin.png";default:return""}});function c(){2===t.notification.msg_type&&window.open(`${window.$getPath("/@root")}/Comments/${t.notification.category}/${t.notification.tid}/${t.notification.name}`,"_self")}return(t,o)=>{const r=b("n-ellipsis");return _(),x("div",O,[y("div",{class:"img",onClick:o[0]||(o[0]=U(t=>I(a)(i.notification.uid),["stop"]))},[y("img",{id:"avatar",src:I(e)(s.value)},null,8,S)]),y("div",{id:"notification",class:"notification",onClick:c},[y("div",{id:"notification_title",class:"notification_title",innerHTML:I(n)(i.notification.msg_title,!0)},null,8,z),y("div",L,[y("div",M,[y("img",{id:"notification_icon",src:I(e)(l.value)},null,8,N)]),y("div",P,[w(r,{"expand-trigger":"click","line-clamp":"2",tooltip:!1,innerHTML:I(n)(i.notification.msg,!0)},null,8,["innerHTML"])])])])])}}}),[["__scopeId","data-v-5bcc06af"]]),A=s(p({__name:"NotificationList",props:{notificationTypeIndexOfUI:{}},setup(i){T(()=>{window.$Logger.logPageView({pageLink:`/Social/Notifications/${f(i.notificationTypeIndexOfUI)}/`,timeStamp:Date.now()})});const{locale:t}=o(),e=m([]),n=m(!1);let a=m(0);const s=m(!1);let d=[{ID:"5c90f172a2409b51dc5cb945",Identifier:"Letter-Test",CategoryID:1,Management:!1,Subject:{Chinese:"一封测试邮件 {Users}",English:"A letter for test {Users}",ChineseTraditional:"一封測試郵件 {Users}",German:"Ein Brief für den Test {Benutzer}",French:"Une lettre pour le test {Utilisateurs}",Japanese:"テスト用の手紙{Users}",Italian:"Una lettera per il test {Utenti}",Polish:null,Spanish:null,Ukrainian:null},Content:{Chinese:"这是一封测试邮件，用于测试所有功能。{Users}",English:"This is a letter for test to test every features. {Users}",ChineseTraditional:"這是一封測試郵件，用於測試所有功能。 {Users}",German:"Dies ist ein Testbrief zum Testen aller Funktionen. {Benutzer}",French:"Ceci est une lettre de test pour tester toutes les fonctionnalités. {Utilisateurs}",Japanese:"これはすべての機能をテストするためのテスト用の手紙です。 {ユーザー}",Italian:"Questa è una lettera per test per testare tutte le funzionalità. {} utenti",Polish:null,Spanish:null,Ukrainian:null},Description:null,Bonuses:{Fragment:1},Action:null,CombineLimit:0,AvailableFrom:15463224e5,AvailableUntil:18934776e5,Push:0}];function f(i){return 3===i?2:2===i?3:i}function u(i,t){var e,n,a,s,o,c,r;return i.replace(/{Users}/g,t.Users.map((i,e)=>`<user=${i}>${t.UserNames[e]}</user>`).join(" ")).replace(/{Experiment}/g,null!==(e=t.Fields)&&void 0!==e&&e.Discussion?`<discussion=${null===(n=t.Fields)||void 0===n?void 0:n.DiscussionID}>${null===(a=t.Fields)||void 0===a?void 0:a.Discussion}</discussion>`:`<experiment${null===(s=t.Fields)||void 0===s?void 0:s.ExperimentID}>${null===(o=t.Fields)||void 0===o?void 0:o.Experiment}</experiment>`).replace(/{\$Content}/g,t.Fields.Content).replace(/{\$TargetName}/g,t.Fields.TargetName||(null===(c=l.getObj("userInfo").value)||void 0===c?void 0:c.nickName)).replace(/{\$Until}/g,t.Fields.Unitl).replace(/{\$Editor}/g,t.Fields.Editor).replace(/{\$Gold}/g,null===(r=t.Numbers)||void 0===r?void 0:r.Gold).replace(/undefined/g,"")}const p=async(o=!0)=>{var p;if(null!==(p=l.getObj("userInfo").value)&&void 0!==p&&p.id&&!n.value&&!s.value){n.value=!0;try{const l=await c("/Messages/GetMessages",{CategoryID:f(i.notificationTypeIndexOfUI),Take:20,Skip:a.value,NoTemplates:o});o||(d=l.Data.Templates);const p=l.Data.Messages;0===p.length&&(s.value=!0,r.emit("warning","没有更多了",2));const m=p.map(i=>{var e,n,a,s,o,l,c,r;const f=d.find(t=>t.ID===i.TemplateID),p=["Chinese","English","ChineseTraditional","German","French","Japanese","Italian","Polish","Spanish","Ukrainian"].includes(t.value)?t.value:"Chinese";return{id:i.ID,msg_title:u(f.Subject[p],i),msg:u(f.Content[p],i),msg_type:(m=i.CategoryID,2===m?3:3===m?2:m),category:null!==(e=i.Fields)&&void 0!==e&&e.User?"User":null!==(n=i.Fields)&&void 0!==n&&n.Discussion?"Discussion":"Experiment",tid:(null===(a=i.Fields)||void 0===a?void 0:a.UserID)||(null===(s=i.Fields)||void 0===s?void 0:s.DiscussionID)||(null===(o=i.Fields)||void 0===o?void 0:o.ExperimentID)||"",name:(null===(l=i.Fields)||void 0===l?void 0:l.Discussion)||(null===(c=i.Fields)||void 0===c?void 0:c.Experiment)||(null===(r=i.Fields)||void 0===r?void 0:r.User)||"",uid:i.Users[0]};var m});e.value=[...e.value,...m],n.value=!1,a.value+=20}catch(m){r.emit("error",String(m),5)}}};return p(!1),(i,t)=>{const n=b("n-divider");return _(),D(E,{"has-more":!s.value,"initial-items":e.value,onLoad:p},{default:F(i=>[(_(!0),x(C,null,$(i.items,i=>(_(),x("div",{key:i.id},[w(G,{notification:i},null,8,["notification"]),w(n,{style:{margin:"0"}})]))),128))]),_:1},8,["has-more","initial-items"])}}}),[["__scopeId","data-v-8d7460d5"]]),B={class:"outer"},H={class:"item"},J={class:"item"},Q={class:"item"},V={class:"item"},K={class:"item"},R={class:"item"};i("default",s(p({__name:"Notifications",setup(i){const{t:t}=o();return T(d),v(d),(i,e)=>{const n=b("n-tab-pane"),a=b("n-tabs");return _(),x(C,null,[w(f,null,{default:F(()=>[y("h1",null,k(I(t)("notifications.title")),1)]),_:1}),y("main",null,[y("div",B,[w(a,{type:"line",animated:"","justify-content":"space-evenly"},{default:F(()=>[w(n,{name:"全部",tab:I(t)("notifications.all")},{default:F(()=>[y("div",H,[w(A,{notificationTypeIndexOfUI:0})])]),_:1},8,["tab"]),w(n,{name:"系统消息",tab:I(t)("notifications.system")},{default:F(()=>[y("div",J,[w(A,{notificationTypeIndexOfUI:1})])]),_:1},8,["tab"]),w(n,{name:"回复和评论",tab:I(t)("notifications.comments")},{default:F(()=>[y("div",Q,[w(A,{notificationTypeIndexOfUI:2})])]),_:1},8,["tab"]),w(n,{name:"关注和粉丝",tab:I(t)("notifications.friends")},{default:F(()=>[y("div",V,[w(A,{notificationTypeIndexOfUI:3})])]),_:1},8,["tab"]),w(n,{name:"作品",tab:I(t)("notifications.works")},{default:F(()=>[y("div",K,[w(A,{notificationTypeIndexOfUI:4})])]),_:1},8,["tab"]),w(n,{name:"管理通知",tab:I(t)("notifications.admin")},{default:F(()=>[y("div",R,[w(A,{notificationTypeIndexOfUI:5})])]),_:1},8,["tab"])]),_:1})])]),w(u)],64)}}}),[["__scopeId","data-v-7c85afc8"]]))}}});
