import{j as O,r as l,o as J,a2 as Q,e as W,Q as w,R as u,L as e,J as p,M as a,S as _,P as N,a3 as X,X as Y,K as Z,W as ee,F as te,h as ae,U as oe,O as x}from"./vue-DM6FGnPB.js";import{d as ne,i as R,g as d,j as D,k as A,s as se,p as B,l as re,e as ie,f as g,_ as le}from"./index-D6Hz3-vS.js";import{T as V,A as ce,s as me}from"./actionSheet-BtHMRMoS.js";import{a as ue,M as pe,p as de}from"./postComment-ZHowVVZ4.js";import"./domPurify-BPcjySmD.js";import"./markdown-DCtE0EIs.js";import"./heilight-WM7bhzTF.js";import"./katex-C_PMC0W0.js";import"./system.config-Nd7wdUBW.js";import"./getUserCurentAvatarByID-C_abxhlB.js";import"./infiniteScroll-CP5iaxsj.js";const ge={style:{"text-align":"left"}},ye=["src"],he=["innerHTML"],fe={style:{position:"absolute","z-index":"100"}},ve={style:{"margin-top":"auto"},class:"coverBottom"},_e={class:"btns",style:{display:"flex","justify-content":"space-around"}},xe={style:{"text-align":"center"},class:"context"},be={class:"gray"},Ce={style:{width:"100%",height:"fit-content"}},we=["src"],De={style:{"text-align":"left"}},Se={style:{color:"#007bff",margin:"2% 0 2% 0",width:"100%","font-size":"16px"}},Ie=["innerHTML"],ke={style:{"margin-top":"3%","background-color":"white","border-radius":"10px",padding:"10px",margin:"5px"}},Le={style:{color:"#007bff","text-align":"left","margin-top":"2px","margin-bottom":"2px"}},Te={style:{height:"90%","max-width":"100%","word-break":"break-all"}},Ee=["innerHTML"],Ue={style:{"font-weight":"bold","text-align":"left"}},$e={class:"right-bottom-container"},Me={class:"message-wrapper"},Pe={class:"sendComment"},je=O({__name:"ExperimentSummary",setup(ze){const h=l(""),S=l(!1),I=l(1),k=l(""),L=l("Intro"),t=Q(),{t:i}=ne(),F=l(window.$getPath("/@base/assets/library/Navigation-Return.png")),o=l({Type:0,ParentID:null,ParentName:null,ParentCategory:null,ContentID:"642cf37a494746375aae306a",Editor:null,Coauthors:[],Description:["Loading..."],LocalizedDescription:null,Tags:["C-Loading"],Visits:0,Stars:0,Supports:0,Remixes:0,Comments:0,Price:0,Popularity:0,ID:"",Category:"Discussion",Subject:"Loading...",LocalizedSubject:null,Image:0,ImageRegion:0,User:{ID:"0",Nickname:"Loading...",Signature:"Loading...",Avatar:0,AvatarRegion:0,Decoration:0,Verification:"Banned"}});let b=l(window.$getPath("/@base/assets/messages/Experiment-Default.png")),T=l(R(o.value.User));J(async()=>{const s=await d("/Contents/GetSummary",{ContentID:t.params.id,Category:t.params.category});o.value=s.Data,T.value=R(o.value.User),await fetch(D(s.Data),{referrerPolicy:"no-referrer",mode:"no-cors"}),b.value=D(s.Data)});function H(s){k.value=s.userID,h.value="回复@".concat(s.msg_title,": ")}async function q(){await de(h,S,t.params.category,t.params.id,k,I)}function G(){window.history.back()}function C(s){navigator.clipboard.writeText(s).then(()=>{g.emit("info","copied",1)}).catch(r=>{g.emit("error","failed to copy text",2,r)})}function K(){var r,f;let s=[{label:i("expeSummary.copyID")},{label:i("expeSummary.copyInternalLink")},{label:i("expeSummary.copyExternalLink")}];o.value.User.ID===((f=(r=ie.getObj("userInfo"))==null?void 0:r.value)==null?void 0:f.id)&&s.push({label:i("expeSummary.changeCover")}),me(s,m=>{if(m===0)C(o.value.ID);else if(m===1)C("<".concat(t.params.category.toLowerCase(),"=").concat(t.params.id,">").concat(o.value.Subject,"</").concat(t.params.category.toLowerCase(),">"));else if(m===2)C("<external=".concat(window.location.href,">").concat(o.value.Subject,"[web]</external>"));else if(m===3)try{const n=document.createElement("input");n.type="file",n.accept="image/*",n.onchange=async v=>{var E,U,$,M;try{const y=v.target.files&&v.target.files[0];if(!y)return;const P=await d("/Contents/GetSummary",{ContentID:t.params.id,Category:t.params.category}),j=(P.Data.Image||0)+1;await d("/Contents/ConfirmExperiment",{Category:t.params.category,SummaryID:t.params.id,Image:j,Extension:".png"});const z=await d("/Contents/SubmitExperiment",{Request:{FileSize:0-Math.abs(y.size),Extension:".jpg"},Summary:P.Data});try{const c=new FormData;c.append("authorization",((U=(E=z.Data)==null?void 0:E.Token)==null?void 0:U.Authorization)||""),c.append("policy",((M=($=z.Data)==null?void 0:$.Token)==null?void 0:M.Policy)||""),c.append("file",y,"cover.jpg"),await fetch("https://v0.api.upyun.com/qphysics",{method:"POST",body:c}),await d("/Contents/ConfirmExperiment",{Category:t.params.category,SummaryID:t.params.id,Image:j,Extension:".png"})}catch(c){g.emit("error","Failed to upload file",2,c);return}g.emit("success","Cover changed successfully",2),setTimeout(async()=>{const c=await d("/Contents/GetSummary",{ContentID:t.params.id,Category:t.params.category});b.value=D(c.Data)},800)}catch(y){g.emit("error","Failed to change cover, please try again later",2,y)}},n.click()}catch(n){g.emit("error","Unknown error, please try again later",2,n)}})}return W(()=>{window.$Logger.logPageView({pageLink:"/".concat(t.params.category,"/").concat(t.params.id,"/"),timeStamp:Date.now()})}),(s,r)=>{const f=N("n-button"),m=N("n-input");return x(),w(ce,null,{left:u(()=>[e("div",{ref:"nickname",class:"cover",style:oe({backgroundImage:"url(".concat(a(b),")")})},[e("div",ge,[e("img",{src:F.value,style:{width:"2.7em"},class:"return",onClick:G},null,8,ye),e("div",{class:"title",onClick:K,innerHTML:a(B)(o.value.Subject)},null,8,he),e("div",fe,[a(t).params.category?(x(),w(V,{key:0,tag:"C-"+a(t).params.category,style:{color:"aquamarine","font-weight":"bold"},category:o.value.Category},null,8,["tag","category"])):Y("",!0),(x(!0),Z(te,null,ee(o.value.Tags.filter(n=>!!n),(n,v)=>(x(),w(V,{key:v,tag:n,category:o.value.Category},null,8,["tag","category"]))),128))])]),e("div",ve,[e("div",_e,[p(f,{type:"info",strong:"",round:"",disabled:"",class:"enter"},{default:u(()=>[ae(_(a(i)("expeSummary.enterExp")),1)]),_:1})])])],4)]),right:u(()=>[e("div",xe,[p(a(re),{value:L.value,"onUpdate:value":r[2]||(r[2]=n=>L.value=n),"justify-content":"space-evenly",type:"line"},{default:u(()=>[p(a(A),{name:"Intro",tab:a(i)("expeSummary.introTab")},{default:u(()=>[e("div",be,[e("div",Ce,[e("div",{style:{display:"flex",height:"60px","background-color":"white","border-radius":"10px",margin:"5px"},onClick:r[0]||(r[0]=n=>a(se)(o.value.User.ID))},[e("img",{src:a(T),style:{margin:"auto 10px",height:"90%","border-radius":"50%"}},null,8,we),e("div",De,[e("p",Se,_(o.value.User.Nickname),1),e("p",{style:{color:"gray",margin:"0%",width:"100%"},innerHTML:a(B)(o.value.User.Signature)},null,8,Ie)])]),e("div",ke,[e("h3",Le,_(a(i)("expeSummary.intro")),1),e("div",Te,[e("div",{class:"intro",style:{"text-align":"left","font-size":"medium"},innerHTML:a(ue)(o.value.Description)},null,8,Ee),e("div",Ue,_(a(i)("expeSummary.wordCount")),1)])])])])]),_:1},8,["tab"]),p(a(A),{name:"Comment",tab:"".concat(a(i)("expeSummary.comments"),"(").concat(o.value.Comments,")")},{default:u(()=>[e("div",$e,[e("div",Me,[p(pe,{ID:a(t).params.id,Category:a(t).params.category,upDate:I.value,onMsgClick:H},null,8,["ID","Category","upDate"])]),e("div",Pe,[p(m,{value:h.value,"onUpdate:value":r[1]||(r[1]=n=>h.value=n),style:{"text-align":"left"},type:"text",placeholder:a(i)("comments.placeholder"),"show-count":"",maxlength:400,loading:S.value,onKeyup:X(q,["enter"])},null,8,["value","placeholder","loading"])])])]),_:1},8,["tab"])]),_:1},8,["value"])])]),_:1})}}}),Je=le(je,[["__scopeId","data-v-06d2e03b"]]);export{Je as default};
